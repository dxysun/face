{% extends 'base_shoot.html' %}

{% block title %}运动员数据分析-运动员主页{% endblock %}

{% block script %}
    {#    <script src="/static/assets/js/pages/sport_game_analyse.js"></script>#}
    <script>
        $(function () {

            var grades = "{{ grades }}";
            var hearts = "{{ hearts }}";
            var data_grade = grades.split(",");
            var data1 = [];
            var r_pos = "{{ r_pos }}";
            var p_pos = "{{ p_pos }}";
            r_pos = r_pos.split(",");
            p_pos = p_pos.split(",");

            //   var data_grade = [];
            var data_index = [];
            for (var j = 0; j < data_grade.length; j++) {
                data_index.push(j + 1);
            }
            for (var i = 0; i < r_pos.length; i++) {
                data1.push([r_pos[i], p_pos[i]]);
            }


            var pie_data = [{{ right_up }}, {{ right_blow }}, {{ left_blow }}, {{ left_up }}];

            var option_pie = {
                title: {
                    text: '打靶位置分布统计',
                    x: 'center'
                },
                tooltip: {
                    trigger: 'item',
                    formatter: "{a} <br/>{b} : {c} ({d}%)"
                },
                legend: {
                  //  orient: 'vertical',
                 //   left: 'left',
                    data: ['右上', '右下', '左下', '左上'],
                    top: 40
                },
                series: [
                    {
                        name: '打靶位置次数占比',
                        type: 'pie',
                        radius: '55%',
                        center: ['50%', '60%'],
                        data: [
                            {value: pie_data[0], name: '右上'},
                            {value: pie_data[1], name: '右下'},
                            {value: pie_data[2], name: '左下'},
                            {value: pie_data[3], name: '左上'}
                        ],
                        itemStyle: {
                            emphasis: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }
                ]
            };

            var options = {
                title: {
                    text: '射击数据图示',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'item',
                    formatter: '{a} : {c}'
                },
                legend: {
                    data: ['射击点'],
                    top: 40
                },
                polar: {
                    radius: 170
                },
                angleAxis: {
                    type: 'value',
                    startAngle: 0,
                    minInterval: 30,
                    maxInterval: 30,
                    interval: 30,
                    splitNumber: 12,
                    max: 360,
                    inverse: true

                },
                radiusAxis: {
                    //     axisAngle: 90,
                    min: 8,
                    max: 11,
                    interval: 1,
                    inverse: true
                },
                {% comment %}  dataZoom: [
                      {
                          type: 'slider',
                          radiusAxisIndex: 0,
                          bottom: 40,
                          start: 0,
                          end: 100
                      },
                      {
                          type: 'inside',
                          radiusAxisIndex: 0,
                          start: 0,
                          end: 100
                      }
                  ],{% endcomment %}
                series: [{
                    coordinateSystem: 'polar',
                    // FIXME
                    // 现在必须得设置这个，能不能polar和catesian一样，要不然很多特殊处理。
                    angleAxisIndex: 0,
                    radiusAxisIndex: 0,
                    name: '射击点',
                    type: 'scatter',
                    symbolSize: 5,
                    data: data1
                }]
            };
            var data_level = [];
            var data_total = [];

            for (var k = 1; k <= 50; k++) {
                data_level.push(k);
                data_total.push(0);
            }
            data_grade.forEach(function (item, index) {

                data_total[Math.floor(item) - 1]++;
            });

            var total_grade = {
                color: ['#3398DB'],
                title: {
                    left: 'center',
                    text: '成绩统计图'
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: { // 坐标轴指示器，坐标轴触发有效
                        type: 'shadow' // 默认为直线，可选为：'line' | 'shadow'
                    }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: [{
                    type: 'category',
                    min: 30,

                    name: '环数',
                    data: data_level,
                    axisTick: {
                        alignWithLabel: true
                    }
                }],
                yAxis: [{
                    type: 'value',
                    name: '次数'
                }],
                series: [{
                    name: '次数',
                    type: 'bar',
                    barWidth: '50%',
                    data: data_total
                }]
            };

            //   var legendData = ['手部', '肩部', '腰部', '臂部'];
            var legendData = ['x方向', 'y方向'];
            var title = "抖动数据折线图";
            var serieData = [];
            var metaDate = [];
            var xAxisData = [];
            // 10-21-23.txt
            var xData = [
                2.750, 0.500, 0.250, 0.250, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, -0.250, 0.000, 0.000,
                0.000, 0.000, 0.000, -0.250, 2.250, 0.750, 0.750, 0.500, 0.250, 0.250, 0.000, 0.000, 0.000, 0.000, 0.000, -0.250, 0.000, 0.000, 0.000, -0.250,
                0.000, 0.000, 0.250, 0.000, 0.000, 0.000, -0.250, 2.500, 1.000, 1.000, 0.250, 0.500, 0.250, 0.000, 0.000, 0.000, 0.000, -0.250, 0.000, -0.250,
                -0.250, 0.000, 0.000, 0.000, 0.000, -0.250, 0.000, 1.500, 1.000, 0.750, 0.750, 0.250, 0.000, 0.000, 0.250, 0.000, 0.000, 0.000, 0.000,
                0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 1.000, 1.250, 1.000, 0.500, 0.250, 0.250, 0.000, 0.000, 0.250, 0.000, 0.500,
                0.000, 0.250, 0.250, 0.250, 0.000, 0.250, 0.250, 0.000, -0.250, -0.250, -1.000, -1.750, -2.750, -1.500, -18.750
            ];
            var yData = [
                0.000, 0.000, -0.250, -0.250, -0.500, -0.250, -0.500, 0.000, -0.250, -0.250, 0.000, -0.250, 0.000,
                -0.250, 0.000, -0.250, 0.000, 4.000, 0.250, 0.000, 0.250, 0.250, -0.500, -0.250, -0.250, -0.500, -0.500, -0.250, -0.500, -0.250, -0.250, 0.000, -0.250,
                0.000, 0.000, -0.250, 0.000, 0.000, 0.000, -0.250, 4.250, 0.000, -0.250, 0.000, -0.500, -0.750, -0.500, -0.250, -0.500, -0.500, -0.500, -0.250, -0.250,
                -0.250, 0.000, 0.000, -0.250, 0.000, 0.000, 0.000, 2.250, 2.000, -0.500, 0.250, -0.250, -0.500, -0.250, -0.250, -0.250, -0.500, 0.000, -0.500,
                -0.500, -0.250, -0.250, 0.000, -0.250, -0.250, 0.000, 0.000, 0.000, 0.750, 2.750, -0.250, 1.000, 0.250, 0.250, 0.250, 0.000, -0.250, -0.250, -0.250,
                -0.500, -0.500, -0.500, -0.500, -0.250, -0.250, -0.250, 0.000, 0.000, 0.000, -1.000, -3.500, -8.000, -10.000, 18.750
            ];

            var len = xData.length;
            metaDate.push(xData);
            metaDate.push(yData);

            for (var p = 0; p < len; p++) {
                xAxisData.push(p + 1);
            }
            for (var v = 0; v < legendData.length; v++) {
                var serie = {
                    name: legendData[v],
                    type: 'line',
                    symbol: "circle",
                    symbolSize: 10,
                    data: metaDate[v]
                };
                serieData.push(serie)
            }
            var colors = ["#036BC8", "#4A95FF", "#5EBEFC", "#2EF7F3", "#FFFFFF"];
            var option_line_shake = {
                backgroundColor: '#0f375f',
                title: {
                    text: title,
                    textAlign: 'left',
                    textStyle: {color: "#fff", fontSize: "16", fontWeight: "normal"}
                },
                legend: {
                    show: true, left: "right", data: legendData, y: "5%",
                    itemWidth: 18, itemHeight: 12, textStyle: {color: "#fff", fontSize: 14},
                },
                dataZoom: {
                    show: true,
                    realtime: true,
                    start: 0,
                    end: 100
                },
                color: colors,
                grid: {left: '2%', top: "12%", bottom: "5%", right: "5%", containLabel: true},
                tooltip: {trigger: 'axis', axisPointer: {type: 'shadow'}},
                xAxis: [
                    {
                        type: 'category',
                        axisLine: {show: true, lineStyle: {color: '#6173A3'}},
                        axisLabel: {interval: 0, textStyle: {color: '#9ea7c4', fontSize: 14}},
                        axisTick: {show: false},
                        data: xAxisData
                    }
                ],
                yAxis: [
                    {
                        axisTick: {show: false},
                        splitLine: {show: false},
                        axisLabel: {textStyle: {color: '#9ea7c4', fontSize: 14}},
                        axisLine: {show: true, lineStyle: {color: '#6173A3'}},
                    }
                ],
                series: serieData
            };


            var values = hearts.split(",");
            var heart_index = [];

            for (var t = 0; t < data_grade.length + 1; t++) {
                heart_index.push(t + 1);
            }
            var option_heart = {
                title: {
                    text: '5次射击平均心率变化数据'
                },
                tooltip: {
                    triggerOn: 'onmousemove',
                    formatter: function (params) {
                        return '次数: ' + params.name + '<br>心跳: ' + params.value + '次';
                    }
                },
                dataZoom: {
                    show: true,
                    realtime: true,
                    start: 0,
                    end: 100
                },
                xAxis: {
                    boundaryGap: false,
                    data: heart_index,
                    axisLabel: {
                        color: '#000000'
                    },
                    axisLine: {
                        lineStyle: {
                            color: '#BFBFBF'
                        }
                    }
                },
                yAxis: {
                    min: 40,
                    axisLabel: {
                        color: '#000000'
                    },
                    axisLine: {
                        lineStyle: {
                            color: '#BFBFBF'
                        }
                    }
                },
                series: [{
                    type: 'line',
                    data: values,
                    color: ['#2F42FF'],
                    symbolSize: 10,
                    label: {
                        normal: {
                            show: true//圆点上显示值
                        }
                    },
                    markLine: {
                        data: [{
                            type: 'average',
                            name: '平均值'
                        }]
                    }
                }]
            };

            var option_grade = {
                title: {
                    left: 'center',
                    text: '5次射击总成绩趋势走向图'
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        animation: false
                    }
                },
                legend: {
                    data: ['射击成绩'],
                    top: 25
                },
                axisPointer: {
                    link: {
                        xAxisIndex: 'all'
                    }
                },
                dataZoom: {
                    show: true,
                    realtime: true,
                    start: 0,
                    end: 100,
                    xAxisIndex: [0, 1]
                },
                grid: [{
                    left: 40,
                    right: 40
                }, {
                    left: 40,
                    right: 40
                }],
                xAxis: [{
                    type: 'category',
                    boundaryGap: true,
                    axisLine: {
                        onZero: true
                    },
                    name: '次数',
                    splitLine: {
                        show: true,
                        lineStyle: {
                            color: '#fcc',
                            width: 1
                        }
                    },
                    data: data_index
                }, {
                    gridIndex: 1
                }],
                yAxis: [{
                    type: 'value',
                    //     max: 10,
                    name: '环数',
                    min: 30,
                    interval: 1,
                    splitLine: {
                        show: true,
                        lineStyle: {
                            color: '#fcc',
                            width: 2
                        }
                    }
                }, {
                    gridIndex: 1
                }],
                series: [{
                    name: '环数',
                    type: 'line',
                    smooth: true,
                    itemStyle: {
                        normal: {
                            color: '#f94427'
                        }
                    },

                    data: data_grade
                }]
            };
            var myGrade = echarts.init(document.getElementById('grade'));
            var myChart = echarts.init(document.getElementById('circle'));
            var myTotalGrade = echarts.init(document.getElementById('total_grade'));
            //     var myLineShake = echarts.init(document.getElementById('line_shake'));
            var myHeart = echarts.init(document.getElementById('heart'));
            var myTotalShake = echarts.init(document.getElementById('total_shake'));

            myChart.setOption(options);
            myGrade.setOption(option_grade);
            myTotalGrade.setOption(total_grade);
            //       myLineShake.setOption(option_line_shake);
            myHeart.setOption(option_heart);
            myTotalShake.setOption(option_pie);
        });


    </script>
{% endblock %}
{% block menu %}

    <ul class="nav" id="main-menu">
        <li>
            <a href="{% url 'sport_home' %}"><i class="fa fa-dashboard"></i> 主界面</a>
        </li>
        {% comment %}     <li>
            <a class="active-menu" href="{% url 'sport_game_analyse' %}"><i class="fa fa-desktop"></i> 射击数据分析</a>
        </li>{% endcomment %}
        <li>
            <a class="active-menu" href="{% url 'sport_game_history' %}"><i class="fa fa-qrcode"></i> 射击数据</a>
        </li>
    </ul>

{% endblock %}


{% block header %}

    <h1 class="page-header">
        比赛数据分析
    </h1>
    <ol class="breadcrumb">
        <li class="active">分析结果</li>
    </ol>
{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-md-6">
            <form role="form">

                <div class="form-group">
                    <label>射击数据分析</label>
                    {% comment %}   <select class="form-control">
                        {% for report in shoot_reports %}
                            <option>时间:{{ report.shoot_date }}&nbsp;&nbsp;&nbsp;成绩:{{ report.remark }}</option>
                        {% endfor %}
                    </select>{% endcomment %}

                </div>
            </form>
        </div>
        <div class="col-md-7">
        </div>
    </div>
    <div class="row">

        <div class="col-md-6">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    比赛成绩概览
                </div>
                <div class="panel-body">
                    <p>在该射击数据中，统计信息如下<br>
                        最好成绩:{{ best_grade }}<br>
                        最坏成绩:{{ bad_grade }}<br>
                        平均成绩:{{ average_grade }}<br>

                    </p>
                </div>
                <div class="panel-footer">
                    本次比赛数据信息统计如下
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    比赛成绩建议
                </div>
                <div class="panel-body">
                    <p> 经您的历史数据分析得，您取得好成绩时肩部的抖动范围为，<br>
                        手部的抖动范围为，<br>
                        腰部的抖动范围为，<br>
                        臂部的抖动范围为，<br>
                        平均心率为<br>
                        您本次的成绩为，哪方面没做好，哪方面需要努力</p>
                </div>

            </div>


        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="panel panel-default">
                <div class="panel-heading">
                    比赛成绩分布图
                </div>
                <div class="panel-body">
                    <div id="circle" style="width: 100%;height:500%;"></div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="panel panel-default">
                <div class="panel-heading">
                    打靶位置统计图
                </div>
                <div class="panel-body">
                    <div id="total_shake" style="width: 100%;height:500%;"></div>
                </div>
            </div>

        </div>
    </div>
    <div class="row">


        <div class="panel panel-default">
            <div class="panel-heading">
                成绩趋势走向图
            </div>
            <div class="panel-body">
                <div id="grade" style="width: 100%;height:500%;"></div>
            </div>
        </div>

    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="panel panel-default">
                <div class="panel-heading">
                    比赛成绩统计图
                </div>
                <div class="panel-body">
                    <div id="total_grade" style="width: 100%;height:500%;"></div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="panel panel-default">
                <div class="panel-heading">
                    成绩心率走向图
                </div>
                <div class="panel-body">
                    <div id="heart" style="width: 100%;height:500%;"></div>
                </div>
            </div>
        </div>
    </div>
    {% comment %} <div class="row">

        <div class="col-md-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    比赛稳定性图
                </div>
                <div class="panel-body">
                    <div id="line_shake" style="width: 100%;height:500%;"></div>
                </div>
            </div>
        </div>
    </div>{% endcomment %}

    <div class="row">
        <div class="col-md-12">
            <!-- Advanced Tables -->
            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-md-4">
                            查看所选射击数据具体信息
                        </div>
                        <div class="col-md-5">
                        </div>
                        <div class="col-md-3">
                        </div>
                    </div>
                    <br>

                </div>
                <div class="panel-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered table-hover">
                            <thead>
                            <tr>

                                <th>时间</th>
                                <th>地点</th>
                                <th>开始时间</th>
                                <th>结束时间</th>
                                <th>备注</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for report in shoot_reports %}
                                <tr class="gradeA">
                                    <td>
                                        <a href="{% url 'sport_game_analyse_id' %}?id={{ report.id }}">{{ report.shoot_date }}</a>
                                    </td>
                                    <td>北京射击馆</td>
                                    <td>{{ report.start_time }}</td>
                                    <td>{{ report.end_time }}</td>
                                    <td>5次射击一共{{ report.remark }}环</td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!--End Advanced Tables -->
        </div>
    </div>
{% endblock %}

